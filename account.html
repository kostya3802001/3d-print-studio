<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-ua="Мій кабінет — 3D-PRINT STUDIO" data-pl="Moj gabinet — 3D-PRINT STUDIO">Мій кабінет — 3D-PRINT STUDIO</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    <div class="logo">
        <img src="log img/Логотип.jpg" alt="Logo" style="height: 40px; vertical-align: middle; margin-right: 10px;">
        3D-PRINT STUDIO
    </div>
    <nav>
        <a href="index.html" data-ua="Головна" data-pl="Glowna">Головна</a>
        <a href="order.html" data-ua="Замовити" data-pl="Zamow">Замовити</a>
        <a href="#" id="logoutBtn" data-ua="Вийти" data-pl="Wyloguj">Вийти</a>
        <span class="lang" style="cursor:pointer">UA | PL</span>
    </nav>
</header>

<section class="section">
    <h2 class="section-title" data-ua="Ваші замовлення" data-pl="Twoje zamowienia">Ваші замовлення</h2>
    <div id="userOrders" style="max-width: 800px; margin: 0 auto;">
        <p style="text-align:center" data-ua="Завантаження замовлень..." data-pl="Ladowanie zamowien...">Завантаження замовлень...</p>
    </div>
</section>

<footer>
    <span data-ua="© 2026 3D-PRINT STUDIO" data-pl="© 2026 3D-PRINT STUDIO">© 2026 3D-PRINT STUDIO</span>
</footer>

<script src="lang.js"></script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, collection, query, where, onSnapshot, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBgAl6GL0DQOhE-JpPAABzb4yvOctfpXXI",
    authDomain: "d-print-studio-25787.firebaseapp.com",
    projectId: "d-print-studio-25787",
    storageBucket: "d-print-studio-25787.firebasestorage.app",
    messagingSenderId: "671010955757",
    appId: "1:671010955757:web:633317a7073d5d6f6c07e4"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  onAuthStateChanged(auth, (user) => {
    if (user) {
      loadUserOrders(user.email);
    } else {
      window.location.href = 'login.html';
    }
  });

  function loadUserOrders(userEmail) {
    // Шукаємо замовлення, де email збігається з поточним користувачем
    const q = query(
        collection(db, "orders"), 
        where("email", "==", userEmail),
        orderBy("timestamp", "desc")
    );

    onSnapshot(q, (snapshot) => {
      const container = document.getElementById('userOrders');
      container.innerHTML = "";

      if (snapshot.empty) {
        container.innerHTML = `<p style="text-align:center" data-ua="У вас ще немає замовлень" data-pl="Nie masz jeszcze zamowien">У вас ще немає замовлень</p>`;
        return;
      }

      snapshot.forEach(doc => {
        const order = doc.data();
        container.innerHTML += `
          <div class="card" style="margin-bottom: 15px; border-left: 5px solid #f39c12;">
            <div class="card-body">
              <div style="display:flex; justify-content:space-between; align-items:center;">
                <strong>${order.fileName}</strong>
                <span style="background:#333; padding:5px 10px; border-radius:5px; color:#f39c12; font-weight:bold;">
                  ${order.status}
                </span>
              </div>
              <p style="margin-top:10px; font-size:0.9em; color:#ccc;">${order.details || 'Без коментаря'}</p>
            </div>
          </div>`;
      });
    });
  }

  // Кнопка виходу
  document.getElementById('logoutBtn').addEventListener('click', () => {
    signOut(auth).then(() => { window.location.href = 'index.html'; });
  });
</script>

</body>
</html>