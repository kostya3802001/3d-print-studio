<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-ua="Мій профіль — 3D-PRINT STUDIO" data-pl="Mój profil — 3D-PRINT STUDIO">Мій профіль — 3D-PRINT STUDIO</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .profile-info {
            background: rgba(243, 156, 18, 0.05);
            border: 1px solid rgba(243, 156, 18, 0.2);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        /* Стиль для статусів */
        .order-status {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
            background: #111;
            color: #f39c12; /* По замовчуванню помаранчевий */
            border: 1px solid #f39c12;
        }
        /* Стиль коли замовлення вже "В роботі" */
        .status-in-progress {
            color: #27ae60 !important;
            border-color: #27ae60 !important;
            background: rgba(39, 174, 96, 0.05) !important;
        }

        .logout-btn {
            background: transparent;
            color: #ff4d4d;
            border: 1px solid #ff4d4d;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: 0.3s;
        }
        .logout-btn:hover {
            background: #ff4d4d;
            color: #000;
        }
    </style>
</head>
<body>

<header>
    <div class="logo">
        <img src="log img/Логотип.jpg" alt="Logo">
        3D-PRINT STUDIO
    </div>
    <nav>
        <a href="index.html" data-ua="Головна" data-pl="Główna">Головна</a>
        <a href="figures.html" data-ua="Фігурки" data-pl="Figurki">Фігурки</a>
        <a href="parts.html" data-ua="Деталі" data-pl="Części">Деталі</a>
        <a href="order.html" data-ua="Замовити" data-pl="Zamów">Замовити</a>
        <button id="logoutBtn" class="logout-btn" style="margin-left: 20px;" data-ua="Вихід" data-pl="Wyloguj">Вихід</button>
        <span class="lang" style="cursor:pointer">UA | PL</span>
    </nav>
</header>

<section class="section">
    <div class="hero-inner" style="margin-bottom: 50px; text-align: center;">
        <h1 data-ua="Особистий <span>кабінет</span>" data-pl="Panel <span>klienta</span>">Особистий <span>кабінет</span></h1>
        <div class="profile-info">
            <p id="userEmail" style="font-size: 18px; color: #fff;">Завантаження...</p>
        </div>
    </div>

    <h2 class="section-title" style="text-align: left; margin-bottom: 30px;" data-ua="Мої замовлення" data-pl="Moje zamówienia">Мої замовлення</h2>
    
    <div class="grid" id="userOrders">
        <p style="color: #666;" data-ua="Завантаження списку..." data-pl="Ładowanie listy...">Завантаження списку...</p>
    </div>
</section>

<footer>
    <span>© 2026 3D-PRINT STUDIO · Професійний кабінет</span>
</footer>

<script src="lang.js"></script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, collection, query, where, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBgAl6GL0DQOhE-JpPAABzb4yvOctfpXXI",
    authDomain: "d-print-studio-25787.firebaseapp.com",
    projectId: "d-print-studio-25787",
    storageBucket: "d-print-studio-25787.firebasestorage.app",
    messagingSenderId: "671010955757",
    appId: "1:671010955757:web:633317a7073d5d6f6c07e4"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  onAuthStateChanged(auth, (user) => {
    if (user) {
      document.getElementById('userEmail').innerText = user.email;
      loadUserOrders(user.uid);
    } else {
      window.location.href = "login.html";
    }
  });

  function loadUserOrders(uid) {
    const q = query(
        collection(db, "orders"), 
        where("userId", "==", uid),
        orderBy("timestamp", "desc")
    );

    onSnapshot(q, (snapshot) => {
      const container = document.getElementById('userOrders');
      container.innerHTML = "";

      if (snapshot.empty) {
        container.innerHTML = `<p style="color: #666;">Ви ще не робили замовлень</p>`;
        return;
      }

      snapshot.forEach(doc => {
        const order = doc.data();
        const date = order.timestamp ? order.timestamp.toDate().toLocaleDateString('uk-UA') : "...";
        
        // Визначаємо клас для статусу
        const statusClass = order.status === "В роботі" ? "order-status status-in-progress" : "order-status";
        const statusText = order.status || "Обробка";
        
        container.innerHTML += `
          <div class="card" style="margin-bottom: 20px;">
            <div class="card-body">
              <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:15px;">
                <span style="color:#666; font-size:12px;">${date}</span>
                <span class="${statusClass}">${statusText}</span>
              </div>
              <h3 style="color:#f39c12; margin-bottom:10px;">${order.type || 'Замовлення 3D-друку'}</h3>
              <p><strong>Матеріал:</strong> ${order.material || 'Не вказано'}</p>
              <p style="font-size:13px; color:#aaa; margin-top:10px; line-height:1.4;">
                ${order.description ? order.description.substring(0, 150) : 'Без опису'}
              </p>
            </div>
          </div>
        `;
      });
    });
  }

  document.getElementById('logoutBtn').onclick = () => {
    signOut(auth).then(() => {
      window.location.href = "index.html";
    });
  };
</script>

</body>
</html>
