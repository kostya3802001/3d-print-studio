<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-ua="Мій профіль — 3D-PRINT STUDIO" data-pl="Mój profil — 3D-PRINT STUDIO">Мій профіль — 3D-PRINT STUDIO</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .profile-info {
            background: rgba(243, 156, 18, 0.05);
            border: 1px solid rgba(243, 156, 18, 0.2);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        /* СТАТУС: Очікування (Помаранчевий) */
        .order-status {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
            background: #111;
            color: #f39c12;
            border: 1px solid #f39c12;
            transition: 0.3s;
        }
        /* СТАТУС: В роботі (Зелений) */
        .status-confirmed {
            color: #27ae60 !important;
            border-color: #27ae60 !important;
            background: rgba(39, 174, 96, 0.1) !important;
            box-shadow: 0 0 10px rgba(39, 174, 96, 0.1);
        }
        .logout-btn {
            background: transparent;
            color: #ff4d4d;
            border: 1px solid #ff4d4d;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: 0.3s;
        }
        .logout-btn:hover {
            background: #ff4d4d;
            color: #000;
        }
        .order-card-custom {
            background: #0d0d0d;
            border: 1px solid #222;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: left;
            position: relative;
        }
    </style>
</head>
<body>

<header>
    <div class="logo">
        <img src="log img/Логотип.jpg" alt="Logo">
        3D-PRINT STUDIO
    </div>
    <nav>
        <a href="index.html" data-ua="Головна" data-pl="Główna">Головна</a>
        <a href="figures.html" data-ua="Фігурки" data-pl="Figurki">Фігурки</a>
        <a href="parts.html" data-ua="Деталі" data-pl="Częсті">Деталі</a>
        <a href="order.html" data-ua="Замовити" data-pl="Zamów">Замовити</a>
        <button id="logoutBtn" class="logout-btn" style="margin-left: 20px;" data-ua="Вихід" data-pl="Wyloguj">Вихід</button>
        <span class="lang" style="cursor:pointer">UA | PL</span>
    </nav>
</header>

<section class="section">
    <div class="hero-inner" style="margin-bottom: 50px; text-align: center;">
        <h1 data-ua="Особистий <span>кабінет</span>" data-pl="Panel <span>klienta</span>">Особистий <span>кабінет</span></h1>
        <div class="profile-info">
            <p id="userEmail" style="font-size: 18px; color: #fff;">Завантаження профілю...</p>
        </div>
    </div>

    <h2 class="section-title" style="text-align: left; margin-bottom: 30px;" data-ua="Мої замовлення" data-pl="Moje zamówienia">Мої замовлення</h2>
    
    <div id="userOrders">
        <p style="color: #666; text-align: center;">Завантаження списку замовлень...</p>
    </div>
</section>

<footer>
    <span>© 2026 3D-PRINT STUDIO · Професійний 3D-друк</span>
</footer>

<script src="lang.js"></script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, collection, query, where, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBgAl6GL0DQOhE-JpPAABzb4yvOctfpXXI",
    authDomain: "d-print-studio-25787.firebaseapp.com",
    projectId: "d-print-studio-25787",
    storageBucket: "d-print-studio-25787.firebasestorage.app",
    messagingSenderId: "671010955757",
    appId: "1:671010955757:web:633317a7073d5d6f6c07e4"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  onAuthStateChanged(auth, (user) => {
    if (user) {
      document.getElementById('userEmail').innerText = user.email;
      loadUserOrders(user.uid);
    } else {
      window.location.href = "login.html";
    }
  });

  function loadUserOrders(uid) {
    const q = query(
        collection(db, "orders"), 
        where("userId", "==", uid),
        orderBy("timestamp", "desc")
    );

    onSnapshot(q, (snapshot) => {
      const container = document.getElementById('userOrders');
      container.innerHTML = "";

      if (snapshot.empty) {
        container.innerHTML = `<p style="color: #666; text-align: center;">У вас поки немає замовлень</p>`;
        return;
      }

      snapshot.forEach(doc => {
        const order = doc.data();
        
        // Обробка дати
        let dateString = "...";
        if (order.timestamp) {
            dateString = order.timestamp.toDate().toLocaleDateString('uk-UA', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // ЛОГІКА СТАТУСІВ
        let statusClass = "order-status"; 
        let statusText = "Очікується підтвердження"; 

        if (order.status === "В роботі") {
            statusClass = "order-status status-confirmed";
            statusText = "Взято в роботу";
        }
        
        container.innerHTML += `
          <div class="order-card-custom">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <span style="color:#555; font-size:11px;">${dateString}</span>
                <span class="${statusClass}">${statusText}</span>
            </div>
            <h3 style="color:#f39c12; margin-bottom:10px; font-size: 18px;">${order.name || 'Замовлення на друк'}</h3>
            <p style="margin-bottom:8px; font-size: 14px;"><strong>Матеріал:</strong> ${order.material || 'Не вказано'}</p>
            <div style="background: rgba(255,255,255,0.03); padding: 10px; border-radius: 8px;">
                <p style="font-size:13px; color:#ccc; line-height:1.5;">
                    ${order.description || 'Опис відсутній'}
                </p>
            </div>
          </div>
        `;
      });
    }, (error) => {
        console.error("Помилка:", error);
        document.getElementById('userOrders').innerHTML = "<p style='color:red;'>Помилка завантаження даних</p>";
    });
  }

  document.getElementById('logoutBtn').onclick = () => {
    signOut(auth).then(() => {
      window.location.href = "index.html";
    });
  };
</script>

</body>
</html>
