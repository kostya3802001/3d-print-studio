<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>ADMIN PANEL — 3D-PRINT STUDIO</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body { background: #121212; color: white; padding: 20px; font-family: sans-serif; }
        .admin-nav { display: flex; gap: 20px; margin-bottom: 30px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .admin-nav button { background: none; border: none; color: #aaa; cursor: pointer; font-size: 1.1em; }
        .admin-nav button.active { color: #f39c12; font-weight: bold; border-bottom: 2px solid #f39c12; }
        .admin-sec { display: none; }
        .admin-sec.active { display: block; }
        .order-card, .form-card { background: #1e1e1e; padding: 20px; border-radius: 10px; margin-bottom: 15px; border: 1px solid #333; }
        input, textarea, select { width: 100%; padding: 10px; margin: 10px 0; background: #2a2a2a; border: 1px solid #444; color: white; border-radius: 5px; }
        .btn-adm { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-green { background: #27ae60; color: white; }
        .btn-orange { background: #e67e22; color: white; }
        .btn-blue { background: #3498db; color: white; }
    </style>
</head>
<body id="adminBody" style="display: none;">

    <header style="display: flex; justify-content: space-between;">
        <h2>CONTROL PANEL</h2>
        <a href="index.html" style="color: #aaa; text-decoration: none;">< На сайт</a>
    </header>

    <nav class="admin-nav">
        <button onclick="openTab('orders')" id="tab-orders" class="active">Замовлення</button>
        <button onclick="openTab('catalog')" id="tab-catalog">Додати в магазин</button>
        <button onclick="openTab('portfolio')" id="tab-portfolio">Додати в портфоліо</button>
    </nav>

    <section id="sec-orders" class="admin-sec active">
        <div id="ordersList">Завантаження...</div>
    </section>

    <section id="sec-catalog" class="admin-sec">
        <div class="form-card">
            <h3>Додати товар у Фігурки/Деталі</h3>
            <form id="catalogForm">
                <input type="text" id="catName" placeholder="Назва товару" required>
                <select id="catCategory">
                    <option value="figures">Фігурки</option>
                    <option value="parts">Деталі</option>
                </select>
                <input type="number" id="catPrice" placeholder="Ціна (грн)" required>
                <input type="text" id="catImg" placeholder="Посилання на фото (наприклад: log img/item1.jpg)" required>
                <button type="submit" class="btn-adm btn-green">Опублікувати товар</button>
            </form>
        </div>
    </section>

    <section id="sec-portfolio" class="admin-sec">
        <div class="form-card">
            <h3>Додати виконану роботу</h3>
            <form id="portForm">
                <input type="text" id="portImg" placeholder="Шлях до фото на GitHub (наприклад: log img/done1.jpg)" required>
                <textarea id="portDesc" placeholder="Опис результату та відгук клієнта" required></textarea>
                <button type="submit" class="btn-adm btn-blue">Додати в портфоліо</button>
            </form>
        </div>
    </section>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBgAl6GL0DQOhE-JpPAABzb4yvOctfpXXI",
    authDomain: "d-print-studio-25787.firebaseapp.com",
    projectId: "d-print-studio-25787",
    storageBucket: "d-print-studio-25787.firebasestorage.app",
    messagingSenderId: "671010955757",
    appId: "1:671010955757:web:633317a7073d5d6f6c07e4"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const ADMIN_EMAIL = "join.the.game.notik.fols@gmail.com";

  onAuthStateChanged(auth, (user) => {
    if (user && user.email === ADMIN_EMAIL) {
      document.getElementById('adminBody').style.display = 'block';
      loadOrders();
    } else {
      window.location.href = 'login.html';
    }
  });

  // Логіка вкладок
  window.openTab = (tabName) => {
    document.querySelectorAll('.admin-sec').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.admin-nav button').forEach(b => b.classList.remove('active'));
    document.getElementById('sec-' + tabName).classList.add('active');
    document.getElementById('tab-' + tabName).classList.add('active');
  };

  // Завантаження замовлень
  function loadOrders() {
    const q = query(collection(db, "orders"), orderBy("timestamp", "desc"));
    onSnapshot(q, (snapshot) => {
      const list = document.getElementById('ordersList');
      list.innerHTML = "";
      snapshot.forEach(docSnap => {
        const o = docSnap.data();
        const id = docSnap.id;
        list.innerHTML += `
          <div class="order-card">
            <span style="color:#f39c12">? ${o.status}</span>
            <p><strong>${o.name}</strong> (${o.contact})</p>
            <p>Файл: <a href="${o.fileUrl}" target="_blank" style="color:#3498db">СКАЧАТИ STL</a></p>
            <button class="btn-adm btn-orange" onclick="updateSt('${id}', 'Прийнято в роботу')">Прийняти</button>
            <button class="btn-adm btn-blue" onclick="updateSt('${id}', 'Йде друк вашої деталі')">Друк</button>
            <button class="btn-adm btn-green" onclick="updateSt('${id}', 'Готово')">Готово</button>
          </div>`;
      });
    });
  }

  window.updateSt = async (id, st) => { await updateDoc(doc(db, "orders", id), { status: st }); };

  // Додавання в каталог
  document.getElementById('catalogForm').onsubmit = async (e) => {
    e.preventDefault();
    await addDoc(collection(db, "catalog"), {
      name: document.getElementById('catName').value,
      category: document.getElementById('catCategory').value,
      price: document.getElementById('catPrice').value,
      image: document.getElementById('catImg').value,
      timestamp: new Date()
    });
    alert("Додано в магазин!"); e.target.reset();
  };

  // Додавання в портфоліо
  document.getElementById('portForm').onsubmit = async (e) => {
    e.preventDefault();
    await addDoc(collection(db, "portfolio"), {
      imagePath: document.getElementById('portImg').value,
      description: document.getElementById('portDesc').value,
      timestamp: new Date()
    });
    alert("Додано в портфоліо!"); e.target.reset();
  };
</script>
</body>
</html>